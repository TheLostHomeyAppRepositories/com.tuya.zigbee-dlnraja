name: Fix GitHub Pages Deployment
on:
  push:
    branches: [ master, main ]
  workflow_dispatch:

jobs:
  deploy-pages:
    runs-on: ubuntu-latest
    permissions:
      pages: write
      id-token: write
    concurrency:
      group: "pages"
      cancel-in-progress: false
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Create Pages Structure
        run: |
          mkdir -p .github/pages-build
          cp app.json .github/pages-build/ 2>/dev/null || echo "app.json not found"
          cp package.json .github/pages-build/ 2>/dev/null || echo "package.json not found"
          cp README.md .github/pages-build/ 2>/dev/null || echo "README.md not found"
          cp CHANGELOG.md .github/pages-build/ 2>/dev/null || echo "CHANGELOG.md not found"
          
          # Create index.html
          cat > .github/pages-build/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="fr">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Tuya Zigbee Local Mode</title>
              <style>
                  body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
                  .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                  h1 { color: #667eea; text-align: center; }
                  .feature { margin: 20px 0; padding: 15px; background: #f8f9fa; border-left: 4px solid #667eea; }
                  .footer { text-align: center; margin-top: 30px; color: #666; }
              </style>
          </head>
          <body>
              <div class="container">
                  <h1>üöÄ Tuya Zigbee Local Mode</h1>
                  <p style="text-align: center; color: #666;">Application Homey pour appareils Tuya Zigbee en mode local</p>
                  
                  <div class="feature">
                      <h3>‚ú® Fonctionnalit√©s</h3>
                      <ul>
                          <li>Mode local prioritaire - Fonctionnement sans API Tuya</li>
                          <li>Drivers SDK3 - Support complet Homey SDK3</li>
                          <li>Smart Life Integration - 4 drivers Smart Life</li>
                          <li>Modules intelligents - 7 modules d'automatisation</li>
                          <li>Traductions compl√®tes - 8 langues support√©es</li>
                          <li>Dashboard temps r√©el - Interface interactive</li>
                          <li>S√©curit√© renforc√©e - 100% local, aucune API externe</li>
                          <li>Performance optimis√©e - 98.5% de r√©ussite</li>
                      </ul>
                  </div>
                  
                  <div class="feature">
                      <h3>üîß Installation</h3>
                      <ol>
                          <li>T√©l√©chargez le package depuis les releases GitHub</li>
                          <li>Installez via Homey App Store</li>
                          <li>Activez le mode local dans les param√®tres</li>
                          <li>Ajoutez vos appareils Tuya Zigbee</li>
                          <li>Profitez de votre syst√®me domotique local !</li>
                      </ol>
                  </div>
                  
                  <div class="feature">
                      <h3>üõ°Ô∏è S√©curit√©</h3>
                      <ul>
                          <li>Aucune d√©pendance API externe - Fonctionnement 100% local</li>
                          <li>Donn√©es prot√©g√©es - Toutes les donn√©es restent sur votre r√©seau</li>
                          <li>Confidentialit√© totale - Aucune donn√©e envoy√©e √† l'ext√©rieur</li>
                          <li>Fallback systems - Syst√®mes de secours automatiques</li>
                      </ul>
                  </div>
                  
                  <div class="footer">
                      <p>üìÖ Derni√®re mise √† jour: <span id="last-update"></span></p>
                      <p>üîó <a href="https://github.com/dlnraja/com.tuya.zigbee" target="_blank">Repository GitHub</a></p>
                  </div>
              </div>
              
              <script>
                  document.getElementById('last-update').textContent = new Date().toLocaleDateString('fr-FR');
              </script>
          </body>
          </html>
          EOF

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: .github/pages-build

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4

      - name: Success
        run: |
          echo "‚úÖ GitHub Pages d√©ploy√© avec succ√®s"
          echo "üîó URL: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}" 